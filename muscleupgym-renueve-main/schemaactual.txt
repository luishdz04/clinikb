-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.access_control_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  enable_biometric boolean DEFAULT true,
  require_active_membership boolean DEFAULT true,
  allow_guest_access boolean DEFAULT false,
  access_schedule_enabled boolean DEFAULT true,
  access_start_time time without time zone DEFAULT '06:00:00'::time without time zone,
  access_end_time time without time zone DEFAULT '23:00:00'::time without time zone,
  access_days_of_week jsonb DEFAULT '["monday", "tuesday", "wednesday", "thursday", "friday", "saturday"]'::jsonb,
  sync_interval_minutes integer DEFAULT 15,
  max_retries integer DEFAULT 3,
  timeout_seconds integer DEFAULT 30,
  zk_websocket_url character varying DEFAULT 'ws://localhost:4001'::character varying,
  zk_capture_timeout integer DEFAULT 15,
  zk_quality character varying DEFAULT 'high'::character varying,
  auto_sync_enabled boolean DEFAULT true,
  notification_enabled boolean DEFAULT true,
  email_notifications boolean DEFAULT false,
  whatsapp_notifications boolean DEFAULT true,
  log_retention_days integer DEFAULT 90,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT access_control_config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.access_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  device_id uuid,
  access_type character varying NOT NULL,
  access_method character varying DEFAULT 'fingerprint'::character varying,
  device_verify_mode integer,
  success boolean NOT NULL DEFAULT true,
  denial_reason character varying,
  membership_status character varying,
  device_timestamp timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT access_logs_pkey PRIMARY KEY (id),
  CONSTRAINT access_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT access_logs_device_id_fkey FOREIGN KEY (device_id) REFERENCES public.biometric_devices(id)
);
CREATE TABLE public.biometric_devices (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  device_id character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  device_type character varying NOT NULL,
  ip_address character varying,
  port integer,
  is_active boolean DEFAULT true,
  location_description text,
  serial_number text UNIQUE,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT biometric_devices_pkey PRIMARY KEY (id)
);
CREATE TABLE public.cash_cut_details (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cash_cut_id uuid,
  transaction_type text NOT NULL CHECK (transaction_type = ANY (ARRAY['membership'::text, 'sale'::text, 'expense'::text])),
  transaction_id uuid NOT NULL,
  amount numeric NOT NULL DEFAULT 0,
  payment_method text CHECK (payment_method = ANY (ARRAY['Efectivo'::text, 'Tarjeta de crÃ©dito'::text, 'Tarjeta de dÃ©bito'::text, 'Transferencia electrÃ³nica'::text])),
  description text,
  transaction_date timestamp without time zone DEFAULT now(),
  created_at timestamp without time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT cash_cut_details_pkey PRIMARY KEY (id),
  CONSTRAINT cash_cut_details_cash_cut_id_fkey FOREIGN KEY (cash_cut_id) REFERENCES public.cash_cuts(id)
);
CREATE TABLE public.cash_cuts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cut_number character varying NOT NULL UNIQUE,
  cut_date date NOT NULL,
  cut_time timestamp without time zone DEFAULT now(),
  grand_total numeric DEFAULT 0,
  status character varying DEFAULT 'open'::character varying,
  is_manual boolean DEFAULT false,
  notes text,
  closed_at timestamp without time zone,
  created_by uuid NOT NULL,
  updated_by uuid,
  closed_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  opening_cash numeric DEFAULT 0,
  expected_cash numeric DEFAULT 0,
  actual_cash numeric DEFAULT 0,
  difference numeric DEFAULT 0,
  total_memberships numeric DEFAULT 0,
  total_sales numeric DEFAULT 0,
  total_expenses numeric DEFAULT 0,
  total_income numeric DEFAULT 0,
  total_cash numeric DEFAULT 0,
  total_card numeric DEFAULT 0,
  total_transfer numeric DEFAULT 0,
  memberships_count integer DEFAULT 0,
  sales_count integer DEFAULT 0,
  expenses_count integer DEFAULT 0,
  period_start timestamp without time zone,
  period_end timestamp without time zone,
  CONSTRAINT cash_cuts_pkey PRIMARY KEY (id),
  CONSTRAINT cash_cuts_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT cash_cuts_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id),
  CONSTRAINT cash_cuts_closed_by_fkey FOREIGN KEY (closed_by) REFERENCES public.employees(id)
);
CREATE TABLE public.categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  subcategories jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.client_announcements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  message text NOT NULL,
  type character varying DEFAULT 'info'::character varying,
  priority integer DEFAULT 0,
  is_active boolean DEFAULT true,
  start_date timestamp with time zone,
  end_date timestamp with time zone,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT client_announcements_pkey PRIMARY KEY (id),
  CONSTRAINT client_announcements_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.coupons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  description text,
  discount_type character varying DEFAULT 'percentage'::character varying,
  discount_value numeric NOT NULL,
  min_amount numeric DEFAULT 0,
  max_uses integer,
  current_uses integer DEFAULT 0,
  start_date date,
  end_date date,
  is_active boolean DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT coupons_pkey PRIMARY KEY (id),
  CONSTRAINT coupons_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id)
);
CREATE TABLE public.customer_wallets (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL UNIQUE,
  balance numeric NOT NULL DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  notes text,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT customer_wallets_pkey PRIMARY KEY (id),
  CONSTRAINT customer_wallets_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT customer_wallets_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id),
  CONSTRAINT customer_wallets_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.daily_access_counters (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  count_date date NOT NULL DEFAULT CURRENT_DATE,
  entry_count integer NOT NULL DEFAULT 0,
  max_entries integer,
  is_blocked boolean NOT NULL DEFAULT false,
  last_entry_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  device_user_id integer,
  original_f22_group integer DEFAULT 2,
  CONSTRAINT daily_access_counters_pkey PRIMARY KEY (id),
  CONSTRAINT daily_access_counters_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.device_user_mappings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  device_id character varying NOT NULL,
  device_user_id integer NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  user_type character varying DEFAULT 'cliente'::character varying,
  CONSTRAINT device_user_mappings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.employees (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL UNIQUE,
  birth_date date,
  gender text,
  marital_status text,
  phone text,
  street text,
  number text,
  neighborhood text,
  city text,
  state text,
  postal_code text,
  country text DEFAULT 'MÃ©xico'::text,
  position text NOT NULL,
  department text,
  hire_date date NOT NULL DEFAULT CURRENT_DATE,
  salary numeric,
  status text DEFAULT 'active'::text,
  emergency_contact_name text,
  emergency_contact_phone text,
  emergency_contact_relationship text,
  fingerprint boolean DEFAULT false,
  fingerprint_enrolled_at timestamp with time zone,
  profile_picture_url text,
  first_name text,
  last_name text,
  email text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  password_hash text,
  updated_by uuid,
  employee_number integer UNIQUE,
  CONSTRAINT employees_pkey PRIMARY KEY (id)
);
CREATE TABLE public.exercise_variants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  exercise_id uuid,
  type character varying,
  name character varying,
  description text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT exercise_variants_pkey PRIMARY KEY (id),
  CONSTRAINT exercise_variants_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id)
);
CREATE TABLE public.exercises (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  type character varying NOT NULL,
  muscle_group_id uuid,
  primary_muscles ARRAY,
  secondary_muscles ARRAY,
  material character varying,
  level character varying,
  initial_position text,
  execution_eccentric text,
  execution_isometric text,
  execution_concentric text,
  common_errors ARRAY,
  contraindications ARRAY,
  video_url text,
  image_url text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT exercises_pkey PRIMARY KEY (id),
  CONSTRAINT exercises_muscle_group_id_fkey FOREIGN KEY (muscle_group_id) REFERENCES public.muscle_groups(id)
);
CREATE TABLE public.expenses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  expense_date date NOT NULL,
  expense_time timestamp without time zone DEFAULT now(),
  expense_type character varying NOT NULL,
  description text NOT NULL,
  amount numeric NOT NULL,
  receipt_number character varying,
  notes text,
  status character varying NOT NULL DEFAULT 'active'::character varying,
  created_by uuid NOT NULL,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  employee_id uuid,
  supplier_id uuid,
  payment_method character varying DEFAULT 'cash'::character varying,
  CONSTRAINT expenses_pkey PRIMARY KEY (id),
  CONSTRAINT expenses_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.employees(id),
  CONSTRAINT expenses_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT expenses_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id),
  CONSTRAINT expenses_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.fingerprint_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  template text NOT NULL,
  device_user_id integer,
  enrolled_at timestamp without time zone DEFAULT now(),
  finger_index integer DEFAULT 1,
  finger_name character varying DEFAULT 'Ãndice Derecho'::character varying,
  primary_template text,
  verification_template text,
  backup_template text,
  combined_template jsonb,
  average_quality integer DEFAULT 85,
  capture_count integer DEFAULT 1,
  capture_time_ms integer DEFAULT 0,
  device_info jsonb DEFAULT '{}'::jsonb,
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  device_id text DEFAULT 'F22_001'::text,
  template_data text,
  quality_score integer DEFAULT 80,
  is_primary boolean DEFAULT false,
  synced_to_device boolean DEFAULT false,
  synced_to_cloud boolean DEFAULT false,
  CONSTRAINT fingerprint_templates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.gym_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  gym_name text DEFAULT 'Muscle Up GYM'::text,
  gym_address text,
  gym_phone text,
  gym_email text,
  gym_logo_url text,
  gym_facebook_url text,
  gym_maps_url text,
  gym_hours jsonb,
  max_capacity integer DEFAULT 100,
  registration_gender_options jsonb,
  registration_marital_status_options jsonb,
  registration_referred_by_options jsonb,
  registration_motivation_options jsonb,
  registration_training_level_options jsonb,
  registration_rules_text text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT gym_settings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.holidays (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  date date NOT NULL,
  name character varying NOT NULL,
  type character varying NOT NULL,
  emoji character varying DEFAULT 'ðŸŽ‰'::character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT holidays_pkey PRIMARY KEY (id)
);
CREATE TABLE public.inventory_movements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  movement_type character varying NOT NULL,
  quantity integer NOT NULL,
  previous_stock integer,
  new_stock integer,
  unit_cost numeric DEFAULT 0,
  total_cost numeric DEFAULT 0,
  reason character varying,
  reference_id uuid,
  notes text,
  source_warehouse_id uuid,
  target_warehouse_id uuid,
  transfer_batch_id uuid,
  auto_generated boolean DEFAULT false,
  skip_stock_processing boolean DEFAULT false,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT inventory_movements_pkey PRIMARY KEY (id),
  CONSTRAINT inventory_movements_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT inventory_movements_source_warehouse_id_fkey FOREIGN KEY (source_warehouse_id) REFERENCES public.warehouses(id),
  CONSTRAINT inventory_movements_target_warehouse_id_fkey FOREIGN KEY (target_warehouse_id) REFERENCES public.warehouses(id),
  CONSTRAINT inventory_movements_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id)
);
CREATE TABLE public.layaway_status_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  layaway_id uuid NOT NULL,
  previous_status character varying,
  new_status character varying,
  previous_paid_amount numeric,
  new_paid_amount numeric,
  reason text,
  created_by uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT layaway_status_history_pkey PRIMARY KEY (id),
  CONSTRAINT layaway_status_history_layaway_id_fkey FOREIGN KEY (layaway_id) REFERENCES public.sales(id),
  CONSTRAINT layaway_status_history_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.membership_change_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  device_id text DEFAULT 'F22_001'::text,
  change_type text NOT NULL,
  reason text,
  processed boolean DEFAULT false,
  processed_at timestamp with time zone,
  error_message text,
  success boolean,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT membership_change_events_pkey PRIMARY KEY (id),
  CONSTRAINT membership_change_events_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.membership_payment_details (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  membership_id uuid,
  payment_method character varying NOT NULL,
  amount numeric NOT NULL,
  commission_rate numeric DEFAULT 0,
  commission_amount numeric DEFAULT 0,
  payment_reference character varying,
  sequence_order integer DEFAULT 1,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT membership_payment_details_pkey PRIMARY KEY (id),
  CONSTRAINT membership_payment_details_membership_id_fkey FOREIGN KEY (membership_id) REFERENCES public.user_memberships(id),
  CONSTRAINT membership_payment_details_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT membership_payment_details_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id)
);
CREATE TABLE public.membership_plans (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  description text,
  is_active boolean DEFAULT true,
  inscription_price numeric DEFAULT 0,
  visit_price numeric DEFAULT 0,
  weekly_price numeric DEFAULT 0,
  biweekly_price numeric DEFAULT 0,
  monthly_price numeric DEFAULT 0,
  bimonthly_price numeric DEFAULT 0,
  quarterly_price numeric DEFAULT 0,
  semester_price numeric DEFAULT 0,
  annual_price numeric DEFAULT 0,
  validity_type character varying DEFAULT 'permanent'::character varying,
  validity_start_date date,
  validity_end_date date,
  features jsonb DEFAULT '[]'::jsonb,
  gym_access boolean DEFAULT true,
  classes_included boolean DEFAULT false,
  guest_passes integer DEFAULT 0,
  equipment_access jsonb DEFAULT '[]'::jsonb,
  has_time_restrictions boolean DEFAULT false,
  allowed_days jsonb DEFAULT '[]'::jsonb,
  time_slots jsonb DEFAULT '[]'::jsonb,
  weekly_duration integer DEFAULT 7,
  biweekly_duration integer DEFAULT 15,
  monthly_duration integer DEFAULT 30,
  bimonthly_duration integer DEFAULT 60,
  quarterly_duration integer DEFAULT 90,
  semester_duration integer DEFAULT 180,
  annual_duration integer DEFAULT 365,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT membership_plans_pkey PRIMARY KEY (id),
  CONSTRAINT membership_plans_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT membership_plans_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id)
);
CREATE TABLE public.muscle_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  description text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT muscle_groups_pkey PRIMARY KEY (id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  type character varying NOT NULL,
  title character varying NOT NULL,
  message text NOT NULL,
  is_read boolean DEFAULT false,
  read_at timestamp with time zone,
  priority character varying DEFAULT 'normal'::character varying,
  action_url character varying,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.payment_commissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  payment_method character varying NOT NULL,
  commission_type character varying DEFAULT 'percentage'::character varying,
  commission_value numeric NOT NULL DEFAULT 0,
  min_amount numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT payment_commissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.plan_access_restrictions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid NOT NULL,
  access_control_enabled boolean DEFAULT true,
  max_daily_entries integer DEFAULT 1,
  daily_schedules jsonb DEFAULT '{}'::jsonb,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT plan_access_restrictions_pkey PRIMARY KEY (id),
  CONSTRAINT plan_access_restrictions_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.membership_plans(id),
  CONSTRAINT plan_access_restrictions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id),
  CONSTRAINT plan_access_restrictions_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.plan_f22_group_mappings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  plan_id uuid NOT NULL,
  device_id text NOT NULL,
  f22_group_id integer NOT NULL CHECK (f22_group_id >= 3),
  f22_timezone_id integer NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT plan_f22_group_mappings_pkey PRIMARY KEY (id),
  CONSTRAINT plan_f22_group_mappings_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.membership_plans(id)
);
CREATE TABLE public.product_warehouse_stock (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  warehouse_id uuid NOT NULL,
  current_stock integer NOT NULL DEFAULT 0,
  reserved_stock integer DEFAULT 0,
  available_stock integer DEFAULT 0,
  min_stock integer DEFAULT 0,
  max_stock integer DEFAULT 1000,
  reorder_point integer DEFAULT 0,
  reorder_quantity integer DEFAULT 0,
  avg_cost numeric DEFAULT 0,
  last_cost numeric DEFAULT 0,
  location_code character varying,
  location_description text,
  last_movement_at timestamp with time zone,
  last_restock_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT product_warehouse_stock_pkey PRIMARY KEY (id),
  CONSTRAINT product_warehouse_stock_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT product_warehouse_stock_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES public.warehouses(id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  description text,
  sku character varying UNIQUE,
  barcode character varying UNIQUE,
  category character varying NOT NULL,
  subcategory character varying,
  brand character varying,
  cost_price numeric NOT NULL DEFAULT 0,
  sale_price numeric NOT NULL DEFAULT 0,
  profit_margin numeric DEFAULT 0,
  current_stock integer DEFAULT 0,
  min_stock integer DEFAULT 0,
  max_stock integer DEFAULT 1000,
  unit character varying DEFAULT 'pieza'::character varying,
  supplier_id uuid,
  image_url text,
  images jsonb DEFAULT '[]'::jsonb,
  is_active boolean DEFAULT true,
  is_taxable boolean DEFAULT true,
  tax_rate numeric DEFAULT 16,
  variants jsonb DEFAULT '[]'::jsonb,
  location character varying,
  expiry_date date,
  reserved_stock integer DEFAULT 0,
  warehouse_stocks jsonb DEFAULT '{}'::jsonb,
  default_warehouse_id uuid,
  total_system_stock integer DEFAULT 0,
  auto_restock_enabled boolean DEFAULT false,
  restock_point integer DEFAULT 0,
  restock_quantity integer DEFAULT 0,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT products_pkey PRIMARY KEY (id),
  CONSTRAINT products_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id),
  CONSTRAINT products_default_warehouse_id_fkey FOREIGN KEY (default_warehouse_id) REFERENCES public.warehouses(id),
  CONSTRAINT products_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT products_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  first_name text NOT NULL,
  last_name text,
  email text,
  password text,
  whatsapp text,
  birth_date text,
  gender text,
  marital_status text,
  is_minor boolean,
  profile_picture_url text,
  signature_url text,
  contract_pdf_url text,
  address_street text,
  address_number text,
  address_neighborhood text,
  address_city text,
  address_state text,
  address_postal_code text,
  address_country text DEFAULT 'MÃ©xico'::text,
  emergency_contact_name text,
  emergency_contact_phone text,
  medical_condition text,
  blood_type text,
  referred_by text,
  main_motivation text,
  receive_plans boolean,
  training_level text,
  email_sent boolean DEFAULT false,
  email_sent_at timestamp with time zone,
  whatsapp_sent boolean DEFAULT false,
  whatsapp_sent_at timestamp with time zone,
  rol text DEFAULT 'cliente'::text,
  fingerprint boolean DEFAULT false,
  points_balance integer DEFAULT 0,
  total_purchases numeric DEFAULT 0,
  membership_type character varying,
  name character varying,
  email_confirmed boolean DEFAULT false,
  email_confirmed_at timestamp with time zone,
  pending_welcome_email boolean DEFAULT true,
  registration_completed boolean DEFAULT false,
  registration_completed_at timestamp with time zone,
  processing_errors boolean DEFAULT false,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  tutor_id_url text,
  member_id integer,
  _deleted boolean DEFAULT false,
  CONSTRAINT profiles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.purchase_orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  supplier_id uuid NOT NULL,
  order_number character varying NOT NULL UNIQUE,
  status character varying DEFAULT 'pending'::character varying,
  total_amount numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  grand_total numeric DEFAULT 0,
  expected_delivery date,
  received_date date,
  notes text,
  items jsonb DEFAULT '[]'::jsonb,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT purchase_orders_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_orders_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id),
  CONSTRAINT purchase_orders_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id),
  CONSTRAINT purchase_orders_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.refund_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  refund_id uuid NOT NULL,
  sale_item_id uuid NOT NULL,
  quantity_refunded integer NOT NULL,
  refund_amount numeric NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT refund_items_pkey PRIMARY KEY (id),
  CONSTRAINT refund_items_refund_id_fkey FOREIGN KEY (refund_id) REFERENCES public.refunds(id),
  CONSTRAINT refund_items_sale_item_id_fkey FOREIGN KEY (sale_item_id) REFERENCES public.sale_items(id)
);
CREATE TABLE public.refunds (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sale_id uuid NOT NULL,
  refund_number character varying NOT NULL UNIQUE,
  refund_type character varying NOT NULL,
  total_refunded numeric NOT NULL DEFAULT 0,
  reason text,
  processed_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT refunds_pkey PRIMARY KEY (id),
  CONSTRAINT refunds_sale_id_fkey FOREIGN KEY (sale_id) REFERENCES public.sales(id),
  CONSTRAINT refunds_processed_by_fkey FOREIGN KEY (processed_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.routine_exercises (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  routine_id uuid NOT NULL,
  exercise_id uuid NOT NULL,
  order_index integer NOT NULL,
  sets integer NOT NULL DEFAULT 3,
  reps character varying,
  rest_seconds integer,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT routine_exercises_pkey PRIMARY KEY (id),
  CONSTRAINT routine_exercises_routine_id_fkey FOREIGN KEY (routine_id) REFERENCES public.workout_routines(id),
  CONSTRAINT routine_exercises_exercise_id_fkey FOREIGN KEY (exercise_id) REFERENCES public.exercises(id)
);
CREATE TABLE public.routine_progress (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_routine_id uuid NOT NULL,
  routine_exercise_id uuid NOT NULL,
  workout_date date NOT NULL DEFAULT CURRENT_DATE,
  completed_sets integer,
  weight_used numeric,
  actual_reps character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT routine_progress_pkey PRIMARY KEY (id),
  CONSTRAINT routine_progress_user_routine_id_fkey FOREIGN KEY (user_routine_id) REFERENCES public.user_routines(id),
  CONSTRAINT routine_progress_routine_exercise_id_fkey FOREIGN KEY (routine_exercise_id) REFERENCES public.routine_exercises(id)
);
CREATE TABLE public.sale_edit_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sale_id uuid NOT NULL,
  edited_by uuid NOT NULL,
  changes_summary text,
  previous_total numeric,
  new_total numeric,
  edit_reason text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT sale_edit_history_pkey PRIMARY KEY (id),
  CONSTRAINT sale_edit_history_sale_id_fkey FOREIGN KEY (sale_id) REFERENCES public.sales(id),
  CONSTRAINT sale_edit_history_edited_by_fkey FOREIGN KEY (edited_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.sale_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sale_id uuid NOT NULL,
  product_id uuid NOT NULL,
  product_name character varying NOT NULL,
  product_sku character varying,
  quantity integer NOT NULL CHECK (quantity > 0),
  unit_price numeric NOT NULL,
  total_price numeric NOT NULL,
  discount_amount numeric DEFAULT 0,
  tax_rate numeric DEFAULT 16,
  tax_amount numeric DEFAULT 0,
  source_warehouse_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT sale_items_pkey PRIMARY KEY (id),
  CONSTRAINT sale_items_sale_id_fkey FOREIGN KEY (sale_id) REFERENCES public.sales(id),
  CONSTRAINT sale_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT sale_items_source_warehouse_id_fkey FOREIGN KEY (source_warehouse_id) REFERENCES public.warehouses(id)
);
CREATE TABLE public.sale_payment_details (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sale_id uuid NOT NULL,
  payment_method character varying NOT NULL,
  amount numeric NOT NULL,
  payment_reference character varying,
  commission_rate numeric DEFAULT 0,
  commission_amount numeric DEFAULT 0,
  sequence_order integer DEFAULT 1,
  payment_date timestamp without time zone DEFAULT now(),
  is_partial_payment boolean DEFAULT false,
  payment_sequence integer DEFAULT 1,
  notes text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT sale_payment_details_pkey PRIMARY KEY (id),
  CONSTRAINT sale_payment_details_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT sale_payment_details_sale_id_fkey FOREIGN KEY (sale_id) REFERENCES public.sales(id)
);
CREATE TABLE public.sales (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sale_number character varying NOT NULL UNIQUE,
  customer_id uuid,
  cashier_id uuid NOT NULL,
  sale_type character varying DEFAULT 'normal'::character varying,
  subtotal numeric NOT NULL DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  coupon_discount numeric DEFAULT 0,
  coupon_code character varying,
  total_amount numeric NOT NULL DEFAULT 0,
  required_deposit numeric DEFAULT 0,
  paid_amount numeric DEFAULT 0,
  pending_amount numeric DEFAULT 0,
  deposit_percentage numeric DEFAULT 50,
  layaway_expires_at timestamp without time zone,
  status character varying DEFAULT 'completed'::character varying,
  payment_status character varying DEFAULT 'paid'::character varying,
  is_mixed_payment boolean DEFAULT false,
  payment_received numeric DEFAULT 0,
  change_amount numeric DEFAULT 0,
  commission_rate numeric DEFAULT 0,
  commission_amount numeric DEFAULT 0,
  notes text,
  receipt_printed boolean DEFAULT false,
  completed_at timestamp without time zone,
  custom_commission_rate numeric,
  skip_inscription boolean DEFAULT false,
  cancellation_date timestamp without time zone,
  payment_plan_days integer,
  initial_payment numeric DEFAULT 0,
  expiration_date date,
  last_payment_date timestamp without time zone,
  cancellation_reason text,
  refund_amount numeric DEFAULT 0,
  refund_method character varying,
  cancellation_fee numeric DEFAULT 0,
  requires_stock_reservation boolean DEFAULT false,
  stock_reserved_at timestamp with time zone,
  stock_released_at timestamp with time zone,
  source_warehouse_id uuid,
  refund_reference text,
  penalty_amount numeric,
  updated_by uuid,
  cancelled_by uuid,
  cancelled_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT sales_pkey PRIMARY KEY (id),
  CONSTRAINT sales_cashier_id_fkey FOREIGN KEY (cashier_id) REFERENCES public.employees(id),
  CONSTRAINT sales_cancelled_by_fkey FOREIGN KEY (cancelled_by) REFERENCES public.employees(id),
  CONSTRAINT sales_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id),
  CONSTRAINT sales_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id),
  CONSTRAINT sales_coupon_code_fkey FOREIGN KEY (coupon_code) REFERENCES public.coupons(code),
  CONSTRAINT sales_source_warehouse_id_fkey FOREIGN KEY (source_warehouse_id) REFERENCES public.warehouses(id)
);
CREATE TABLE public.special_access_schedules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  date date NOT NULL UNIQUE,
  is_holiday boolean DEFAULT false,
  is_closed boolean DEFAULT false,
  special_start_time time without time zone,
  special_end_time time without time zone,
  description text,
  applies_to_plans jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT special_access_schedules_pkey PRIMARY KEY (id)
);
CREATE TABLE public.store_credits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL,
  amount numeric NOT NULL,
  balance numeric NOT NULL,
  reason text,
  expiration_date date,
  is_active boolean DEFAULT true,
  used_at timestamp without time zone,
  used_by uuid,
  created_by uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT store_credits_pkey PRIMARY KEY (id),
  CONSTRAINT store_credits_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id),
  CONSTRAINT store_credits_used_by_fkey FOREIGN KEY (used_by) REFERENCES public.profiles(id),
  CONSTRAINT store_credits_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.suppliers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_name character varying NOT NULL,
  contact_person character varying,
  email character varying,
  phone character varying,
  whatsapp character varying,
  website character varying,
  rfc character varying,
  address jsonb DEFAULT '{}'::jsonb,
  payment_terms character varying DEFAULT 'contado'::character varying,
  credit_limit numeric DEFAULT 0,
  current_balance numeric DEFAULT 0,
  rating integer DEFAULT 5,
  is_active boolean DEFAULT true,
  categories jsonb DEFAULT '[]'::jsonb,
  delivery_time integer DEFAULT 7,
  notes text,
  documents jsonb DEFAULT '[]'::jsonb,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT suppliers_pkey PRIMARY KEY (id),
  CONSTRAINT suppliers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT suppliers_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id)
);
CREATE TABLE public.survey_questions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  survey_id uuid NOT NULL,
  question_text text NOT NULL,
  question_type character varying NOT NULL,
  options jsonb,
  is_required boolean DEFAULT false,
  question_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT survey_questions_pkey PRIMARY KEY (id),
  CONSTRAINT survey_questions_survey_id_fkey FOREIGN KEY (survey_id) REFERENCES public.surveys(id)
);
CREATE TABLE public.survey_responses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  survey_id uuid NOT NULL,
  user_id uuid NOT NULL,
  question_id uuid NOT NULL,
  answer_text text,
  answer_option character varying,
  submitted_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT survey_responses_pkey PRIMARY KEY (id),
  CONSTRAINT survey_responses_survey_id_fkey FOREIGN KEY (survey_id) REFERENCES public.surveys(id),
  CONSTRAINT survey_responses_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT survey_responses_question_id_fkey FOREIGN KEY (question_id) REFERENCES public.survey_questions(id)
);
CREATE TABLE public.surveys (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  description text,
  start_date timestamp with time zone NOT NULL,
  end_date timestamp with time zone NOT NULL,
  is_active boolean DEFAULT true,
  max_responses_per_user integer DEFAULT 1,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT surveys_pkey PRIMARY KEY (id),
  CONSTRAINT surveys_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.system_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  action_type character varying NOT NULL,
  description text,
  affected_records integer DEFAULT 0,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT system_logs_pkey PRIMARY KEY (id),
  CONSTRAINT system_logs_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.temporary_access (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  guest_name character varying,
  guest_phone character varying,
  sponsor_user_id uuid NOT NULL,
  access_type character varying DEFAULT 'guest'::character varying,
  valid_from timestamp with time zone DEFAULT now(),
  valid_until timestamp with time zone NOT NULL,
  max_entries integer DEFAULT 1,
  current_entries integer DEFAULT 0,
  access_code character varying UNIQUE,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT temporary_access_pkey PRIMARY KEY (id),
  CONSTRAINT temporary_access_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT temporary_access_sponsor_user_id_fkey FOREIGN KEY (sponsor_user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.trigger_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  trigger_type text NOT NULL,
  status text NOT NULL,
  details jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT trigger_logs_pkey PRIMARY KEY (id),
  CONSTRAINT trigger_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.user_memberships (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  plan_id uuid,
  payment_type character varying NOT NULL,
  total_amount numeric NOT NULL,
  inscription_amount numeric DEFAULT 0,
  start_date date NOT NULL,
  end_date date,
  status character varying DEFAULT 'active'::character varying,
  freeze_start_date date,
  freeze_end_date date,
  freeze_reason text,
  total_visits integer DEFAULT 1,
  remaining_visits integer DEFAULT 1,
  notes text,
  coupon_code character varying,
  is_renewal boolean DEFAULT false,
  skip_inscription boolean DEFAULT false,
  freeze_date date,
  unfreeze_date date,
  total_frozen_days integer DEFAULT 0,
  paid_amount numeric DEFAULT 0,
  pending_amount numeric DEFAULT 0,
  whatsapp_sent boolean DEFAULT false,
  whatsapp_sent_at timestamp with time zone,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  reminder_sent boolean DEFAULT false,
  reminder_sent_at timestamp with time zone,
  CONSTRAINT user_memberships_pkey PRIMARY KEY (id),
  CONSTRAINT user_memberships_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT user_memberships_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.membership_plans(id),
  CONSTRAINT user_memberships_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT user_memberships_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id)
);
CREATE TABLE public.user_routines (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  routine_id uuid NOT NULL,
  assigned_by uuid,
  assigned_date timestamp without time zone DEFAULT now(),
  start_date date,
  end_date date,
  status character varying DEFAULT 'active'::character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT user_routines_pkey PRIMARY KEY (id),
  CONSTRAINT user_routines_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT user_routines_routine_id_fkey FOREIGN KEY (routine_id) REFERENCES public.workout_routines(id),
  CONSTRAINT user_routines_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.wallet_transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  wallet_id uuid NOT NULL,
  transaction_type character varying NOT NULL,
  amount numeric NOT NULL,
  balance_before numeric NOT NULL,
  balance_after numeric NOT NULL,
  reference_type character varying,
  reference_id uuid,
  description text,
  notes text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT wallet_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT wallet_transactions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT wallet_transactions_wallet_id_fkey FOREIGN KEY (wallet_id) REFERENCES public.customer_wallets(id)
);
CREATE TABLE public.warehouse_transfer_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  transfer_id uuid NOT NULL,
  product_id uuid NOT NULL,
  requested_quantity integer NOT NULL,
  approved_quantity integer DEFAULT 0,
  shipped_quantity integer DEFAULT 0,
  received_quantity integer DEFAULT 0,
  unit_cost numeric DEFAULT 0,
  total_cost numeric DEFAULT 0,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT warehouse_transfer_items_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_transfer_items_transfer_id_fkey FOREIGN KEY (transfer_id) REFERENCES public.warehouse_transfers(id),
  CONSTRAINT warehouse_transfer_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.warehouse_transfers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  transfer_number character varying NOT NULL UNIQUE,
  source_warehouse_id uuid NOT NULL,
  target_warehouse_id uuid NOT NULL,
  status character varying DEFAULT 'pending'::character varying,
  transfer_type character varying DEFAULT 'manual'::character varying,
  priority character varying DEFAULT 'normal'::character varying,
  reason text,
  notes text,
  total_items integer DEFAULT 0,
  total_quantity integer DEFAULT 0,
  total_value numeric DEFAULT 0,
  requested_at timestamp with time zone DEFAULT now(),
  approved_at timestamp with time zone,
  shipped_at timestamp with time zone,
  received_at timestamp with time zone,
  cancelled_at timestamp with time zone,
  created_by uuid,
  approved_by uuid,
  shipped_by uuid,
  received_by uuid,
  cancelled_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT warehouse_transfers_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_transfers_source_warehouse_id_fkey FOREIGN KEY (source_warehouse_id) REFERENCES public.warehouses(id),
  CONSTRAINT warehouse_transfers_target_warehouse_id_fkey FOREIGN KEY (target_warehouse_id) REFERENCES public.warehouses(id),
  CONSTRAINT warehouse_transfers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT warehouse_transfers_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.employees(id),
  CONSTRAINT warehouse_transfers_shipped_by_fkey FOREIGN KEY (shipped_by) REFERENCES public.employees(id),
  CONSTRAINT warehouse_transfers_received_by_fkey FOREIGN KEY (received_by) REFERENCES public.employees(id),
  CONSTRAINT warehouse_transfers_cancelled_by_fkey FOREIGN KEY (cancelled_by) REFERENCES public.employees(id),
  CONSTRAINT warehouse_transfers_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id)
);
CREATE TABLE public.warehouses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text,
  address jsonb DEFAULT '{}'::jsonb,
  warehouse_type character varying NOT NULL,
  is_active boolean DEFAULT true,
  is_default boolean DEFAULT false,
  manager_user_id uuid,
  auto_restock_enabled boolean DEFAULT false,
  min_stock_threshold numeric DEFAULT 0.2,
  max_capacity integer,
  current_capacity integer DEFAULT 0,
  operating_hours jsonb DEFAULT '{}'::jsonb,
  time_zone character varying DEFAULT 'America/Mexico_City'::character varying,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT warehouses_pkey PRIMARY KEY (id),
  CONSTRAINT warehouses_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.employees(id),
  CONSTRAINT warehouses_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.employees(id),
  CONSTRAINT warehouses_manager_user_id_fkey FOREIGN KEY (manager_user_id) REFERENCES public.employees(id)
);
CREATE TABLE public.workout_routines (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  description text,
  difficulty_level character varying,
  estimated_duration integer,
  muscle_group_focus character varying,
  is_public boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  _deleted boolean DEFAULT false,
  CONSTRAINT workout_routines_pkey PRIMARY KEY (id),
  CONSTRAINT workout_routines_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);